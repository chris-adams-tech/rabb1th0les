---
Owner: Chris Adams
title: CVE-2023-23397
type: Vulnerability Review
topic: 
date: 2024-11-30
tags:
  - status/wip
draft: true
reference:
---
# Summary
CVE-2023-23397 vulnerability allows attackers to steal Windows NTLM hashes without any user interaction, simply by sending a specially crafted email. This attack was notably used by a Russian state-sponsored group MIDNIGHT BLIZZARD (formerly NOBELIUM) before it was patched.

# Technical Details
Affected Systems:

- Microsoft Outlook for Windows
- All versions before the March 2023 update
- Requires no special privileges to execute
- Network access required

|Event ID|MITRE ATT&CK|Kill Chain|Command Line|Tools Used|
|---|---|---|---|---|
|4624|T1187 (Forced Authentication)|Initial Access|N/A|Custom email crafting tools|
|4625|T1003 (Credential Dumping)|Credential Access|N/A|Responder, ntlmrelayx|
|4776|T1557 (LLMNR/NBT-NS Poisoning)|Lateral Movement|`responder -I eth0 -w -r -f`|Impacket suite|

## Rule Creation

### Step 1: Monitor for Suspicious Network Connections

```powershell
New-NetFirewallRule -DisplayName "Block SMB Outbound" -Direction Outbound -Protocol TCP -LocalPort 445 -Action Block
```

### Step 2: Create Detection Rule for Event ID 4624

```xml
<QueryList>   
	<Query Id="0">    
		<Select Path="Security">      *[System[(EventID=4624)] and        EventData[Data[@Name='LogonType']='3'] and        EventData[Data[@Name='IpAddress']!='127.0.0.1']]    </Select>  
</Query> 
</QueryList>`
```

### Step 3: Monitor Calendar Items

```powershell
Get-EventLog -LogName "Application" -Source "Microsoft-Windows-CAPI2" |  Where-Object {$_.EventID -eq 70 -and $_.Message -like "*calendar*"}
```

Sources:

1. [https://msrc.microsoft.com/update-guide/vulnerability/CVE-2023-23397](https://msrc.microsoft.com/update-guide/vulnerability/CVE-2023-23397)
2. [https://attack.mitre.org/techniques/T1187/](https://attack.mitre.org/techniques/T1187/)
3. [https://www.mandiant.com/resources/blog/hunting-attestation-tokens](https://www.mandiant.com/resources/blog/hunting-attestation-tokens)
4. [https://www.microsoft.com/security/blog/2023/03/24/guidance-for-investigating-attacks-using-cve-2023-23397/](https://www.microsoft.com/security/blog/2023/03/24/guidance-for-investigating-attacks-using-cve-2023-23397/)

This vulnerability is particularly dangerous because:

- No user interaction required
- Works against unpatched systems
- Can be used to gain initial access and move laterally
- Difficult to detect without proper monitoring

The best mitigation is to:

1. Apply the March 2023 security update
2. Block TCP 445/SMB outbound
3. Implement NTLM blocking
4. Monitor for suspicious authentication attempts


<div class="neon-line"></div>

Thanks for taking the time to read through my content. If you enjoy this type of content, check back here for more updates. 

Peace ‚úåÔ∏è

#### Created on: Nov-30-24
---

<div style="text-align: center;">
	<div class="gradient-text">üëæ 2024 rabb1th0les (Chris A)dams üëæ</div> 
	üå¥‚òÄThanks for supporting my page ‚òÄüå¥
	<nav>
		<ul style="list-style: none; padding: 0;">
			<div style="text-align: center;">
				<li><a href="index.html">Home</a> | <a href="Contact.html">Contact</a></li>
			</div>
		</ul>
	</nav>	
</div>
