---
Owner: Chris Adams
title: Unauthorized Access and Data Exfiltration in AWS Environment
date: 2024-11-13
layout: new_page
tags:
  - ai-generated
draft: false
topic: cloud
---
> [!Important] Important!
> This is a fake scenario generated by AI and is meant solely for educational purposes. 

### **Scenario: Unauthorized Access and Data Exfiltration in AWS Environment**

#### **Background:**
Itâ€™s early Monday morning, and your security operations dashboard lights up with alerts indicating suspicious activity in your companyâ€™s AWS environment. Initial investigation suggests that a recently created IAM user account, `temp-support-user`, is accessing sensitive S3 buckets and initiating unusual EC2 instances in regions not typically used by your organization.

The activity suggests that an attacker has gained unauthorized access to this account, potentially with API keys or temporary credentials. Your job is to investigate the source of the compromise, assess the scope of data accessed, and take immediate containment actions to protect the environment.

<div class="neon-line"></div>

#### **Alert Summary:**

1. **Unusual S3 Access Patterns Detected**  
   Type: AWS CloudTrail Alert  
   Source: `temp-support-user`  
   Description: The IAM user `temp-support-user` is accessing S3 buckets `s3://company-sensitive-data` and `s3://confidential-backups` from an unfamiliar IP. The user is attempting `GetObject` and `ListBucket` actions repeatedly, suggesting data enumeration and possible exfiltration.

2. **Unauthorized EC2 Instances Created in New Regions**  
   Type: AWS Config Alert  
   Source: `temp-support-user`  
   Description: `temp-support-user` launched EC2 instances in regions `us-west-2` and `eu-central-1`, which are not typically used by your organization. This action is flagged as unusual based on standard operating procedures.

3. **IAM Policy Modification Detected for `temp-support-user`**  
   Type: AWS CloudTrail Alert  
   Source: `temp-support-user`  
   Description: The IAM policy attached to `temp-support-user` was modified to include `s3:*` and `ec2:*` permissions, allowing full access to S3 and EC2 resources.

4. **Suspicious API Calls from Unrecognized IP Address**  
   Type: AWS GuardDuty Alert  
   Source: `temp-support-user`  
   Description: Multiple API calls made from `temp-support-user` were logged from an IP address (203.0.113.45) not previously seen in the organizationâ€™s normal range of IPs.

<div class="neon-line"></div>

### **Objective:**
Determine how the attacker obtained access to `temp-support-user`, assess the scope of compromised AWS resources, and implement containment actions. Look for signs of data exfiltration and possible persistence mechanisms (e.g., modified IAM policies or backdoor access).

<div class="neon-line"></div>

### **Fake Telemetry Details and Logs**

#### **Alert 1: Unusual S3 Access Patterns Detected**

**Telemetry Data (S3 Access Logs):**
- **Source Account**: `temp-support-user`
- **Source IP**: 203.0.113.45
- **Accessed Buckets**:
  - `s3://company-sensitive-data` (ListBucket, GetObject actions for multiple files, including `financial_report_2022.xlsx` and `employee_data.csv`)
  - `s3://confidential-backups` (ListBucket, GetObject actions for files like `backup_01_2023.tar.gz`)

**Event Timeline**:
- **1:15 AM** - First ListBucket request to `s3://company-sensitive-data`
- **1:20 AM** - Multiple GetObject requests targeting files in the sensitive data bucket
- **1:45 AM** - Repeated ListBucket and GetObject requests on `s3://confidential-backups`

**Analysis:**  
This pattern suggests data enumeration and potential exfiltration attempts, especially if large files in the backup bucket are accessed.

<div class="neon-line"></div>

#### **Alert 2: Unauthorized EC2 Instances Created in New Regions**

**Telemetry Data (EC2 Activity):**
- **Source Account**: `temp-support-user`
- **Regions**: `us-west-2`, `eu-central-1`
- **Instances Created**:
  - **us-west-2**: `i-0234abc567d890ef1` with AMI `ami-0abcdef1234567890`  
  - **eu-central-1**: `i-09abcdef123456789` with AMI `ami-0fedcba9876543210`  

**Instance Details**:
- **Instance Type**: t2.micro
- **Tags**: None
- **Launch Timeline**:
  - **2:10 AM** - Instance created in `us-west-2`
  - **2:15 AM** - Instance created in `eu-central-1`

**Analysis:**  
Creating EC2 instances in unfamiliar regions may indicate the attacker is setting up infrastructure for staging data or further exploitation. The lack of tags could signify an attempt to blend in or avoid detection.

<div class="neon-line"></div>

#### **Alert 3: IAM Policy Modification Detected for `temp-support-user`**

**Telemetry Data (IAM Policy Modification Logs):**
- **User**: `temp-support-user`
- **Policy Changes**:
  - Added policy `s3:*` (Full S3 access)
  - Added policy `ec2:*` (Full EC2 access)
  - Modified using the `AttachUserPolicy` API call from IP 203.0.113.45

**Event Timeline**:
- **12:45 AM** - `s3:*` policy added to `temp-support-user`
- **12:47 AM** - `ec2:*` policy added to `temp-support-user`

**Analysis:**  
The attacker likely elevated permissions on the compromised `temp-support-user` to gain broader access across S3 and EC2, enabling enumeration and resource creation. This behavior is a common technique to allow unrestricted exploration and potential persistence.

<div class="neon-line"></div>

#### **Alert 4: Suspicious API Calls from Unrecognized IP Address**

**Telemetry Data (GuardDuty Findings):**
- **Source IP**: 203.0.113.45 (unrecognized, outside known ranges)
- **API Calls Made**:
  - `ListUsers` and `ListRoles` (IAM reconnaissance)
  - `DescribeInstances` (EC2 enumeration)
  - `GetBucketPolicy` and `GetBucketAcl` (S3 enumeration)
- **Event Timeline**:
  - **1:00 AM** - IAM enumeration (`ListUsers`, `ListRoles`)
  - **1:05 AM** - S3 and EC2 enumeration begins

**Analysis:**  
The API activity from this unfamiliar IP indicates reconnaissance and access escalation within AWS. The attacker is likely trying to map the environment to identify accessible resources.

<div class="neon-line"></div>

### **Investigation Steps**

Hereâ€™s a structured investigation approach for analyzing this AWS security incident.

#### **Step 1: Verify Unauthorized Access to `temp-support-user`**

- **Analyze Access Patterns and Key Usage**:
  - Check CloudTrail for recent events showing `temp-support-user` key creation, usage, and potential exposures.
  - Confirm if API keys were accidentally exposed or if temporary credentials (e.g., AWS session tokens) were leaked.

- **Confirm Source of Unauthorized IP**:
  - Review GuardDuty alerts to see if IP 203.0.113.45 has interacted with other IAM accounts or AWS services, suggesting broader access attempts.

#### **Step 2: Investigate S3 Data Access and Exfiltration**

- **Review S3 Access Logs**:
  - Analyze the S3 `GetObject` requests for volume and file types accessed, focusing on large or sensitive files.
  - Determine if S3 logs indicate potential data transfer to external IPs.

- **Check for Data Transfer Patterns**:
  - Review AWS VPC Flow Logs or CloudTrail data transfer metrics if available, to track data movement from S3 buckets.

#### **Step 3: Confirm Unauthorized EC2 Instance Launches**

- **Inspect EC2 Configurations**:
  - Look for unusual configurations, such as new SSH key pairs, custom security groups, or attached storage that could indicate staging or data exfiltration.
  - Verify if the EC2 instances in `us-west-2` and `eu-central-1` were accessed by unfamiliar IPs, potentially linking to the attacker.

- **Assess Purpose of Instances**:
  - Review the software, open ports, and any user data scripts that might be running, as these could contain payloads for exfiltration or additional AWS reconnaissance.

#### **Step 4: Validate IAM Policy Changes and Containment Steps**

- **Inspect IAM Changes**:
  - Confirm when the `s3:*` and `ec2:*` policies were added, by whom, and check if other users have similar modifications.
  - Review CloudTrail logs for any unusual policy or permission changes on other sensitive accounts or groups.

- **Check for Persistence Indicators**:
  - Look for newly created IAM roles or users that could indicate backdoors.
  - Assess if `temp-support-user` is used to set up any cross-account access roles or policies.

<div class="neon-line"></div>

### **Containment and Remediation Actions**

1. **Immediate Actions**:
   - **Revoke All Active Sessions for `temp-support-user`** to prevent further access, and disable the IAM user.
   - **Remove the Added IAM Policies** (`s3:*`, `ec2:*`) from `temp-support-user` to limit permissions.
   - **Terminate Unfamiliar EC2 Instances** in `us-west-2` and `eu-central-1` to eliminate attacker infrastructure.

2. **Remediation**:
   - **Rotate All Access Keys** for `temp-support-user` and any other accounts accessed by the unauthorized IP.
   - **Audit S3 Bucket Policies and Access Controls**: Review all sensitive S3 buckets to


<div class="neon-line"></div>

#### Created on: Nov 12, 2024
---
<div style="text-align: center;">
	<div class="gradient-text">ðŸ‘¾ 2024 rabb1th0les (Chris A)dams ðŸ‘¾</div> 
	ðŸŒ´â˜€Thanks for supporting my page â˜€ðŸŒ´
	<nav>
		<ul style="list-style: none; padding: 0;">
			<div style="text-align: center;">
				<li><a href="index.html">Home</a> | <a href="Contact.html">Contact</a></li>
			</div>
		</ul>
	</nav>	
</div>