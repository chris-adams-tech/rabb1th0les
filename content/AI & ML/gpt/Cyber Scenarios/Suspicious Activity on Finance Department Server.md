---
Owner: Chris Adams
title: Suspicious Activity on Finance Department Server
type: Simulated Scenario
topic: data exfil
summary: SOC is receiving alerts from finance department indicating potential data exfiltration.
date: 2024-11-13
tags:
  - ai-generated
  - data-exfil
  - threat-hunting
  - inve
draft: false
goal: Investigate and correlate alerts to determine root cause.
---
> [!Important] Important!
> This is a fake scenario generated by AI and is meant solely for educational purposes. 
### **Scenario: Suspicious Activity on Finance Department Server**

#### **Background:**
It’s Tuesday afternoon, and the SOC has started receiving alerts indicating suspicious activity on the finance department’s application server, `FIN-SERVER01`. Initial alerts suggest possible unauthorized access and data exfiltration. However, additional alerts across various systems and departments create noise, making it harder to identify which events are connected to the main incident.

### **Objective:**
Analyze the alerts, correlate relevant events, identify the main compromise, and filter out unrelated noise to effectively contain the threat.

<div class="neon-line"></div>

### **Alerts Summary Table**

| **Alert ID** | **Alert Type**                 | **Source**               | **Description**                                                                                  |
| ------------ | ------------------------------ | ------------------------ | ------------------------------------------------------------------------------------------------ |
| 001          | Unauthorized File Access       | `FIN-SERVER01`           | High-volume access to sensitive files on `FIN-SERVER01`, detected through access logs.           |
| 002          | Failed Authentication Attempt  | `HR-WKS05`               | Repeated failed logins on HR workstation, `HR-WKS05`, from an external IP (198.51.100.101).      |
| 003          | Suspicious PowerShell Activity | `FIN-SERVER01`           | Encoded PowerShell script executed on `FIN-SERVER01`, showing signs of remote command execution. |
| 004          | Unusual Traffic to External IP | `FIN-SERVER01`           | Outbound connection to suspicious IP `203.0.113.45`, with large data transfer over HTTPS.        |
| 005          | Unauthorized RDP Access        | `FIN-SERVER01`           | Successful remote desktop login to `FIN-SERVER01` by a non-privileged account.                   |
| 006          | Malware Detection              | `ENG-SERVER03`           | Known malware (`Emotet`) detected on `ENG-SERVER03`, a server unrelated to finance operations.   |
| 007          | New Administrative Account     | `FIN-SERVER01`           | New admin-level user account `temp_admin` created on `FIN-SERVER01` without change approval.     |
| 008          | High Outbound Data Transfer    | `FIN-SERVER01`           | Significant outbound data transfer detected from `FIN-SERVER01` to IP `192.0.2.50` over FTP.     |
| 009          | Anomalous Email Activity       | `Employee10@company.com` | Employee account sent over 200 emails in a short period, flagged as potential phishing.          |
| 010          | Suspicious Scheduled Task      | `FIN-SERVER01`           | New scheduled task created to run an encoded PowerShell script every hour on `FIN-SERVER01`.     |

<div class="neon-line"></div>

### **Investigation Steps and Analysis**

1. **Step 1: Identify the Primary Compromise and Filter Out Unrelated Alerts**
   - Begin by reviewing `FIN-SERVER01` alerts, as this server is central to the finance department and contains sensitive data.
   - **Irrelevant Alerts:**
     - **Alert 002**: Failed login attempts on `HR-WKS05` from an external IP are likely unrelated, as `HR-WKS05` is a separate department and unrelated to finance operations.
     - **Alert 006**: Malware (`Emotet`) detected on `ENG-SERVER03` is irrelevant to the finance server.
     - **Alert 009**: Anomalous email activity from `Employee10@company.com` is outside the scope of the finance server investigation, likely an unrelated phishing issue.
   - **Relevant Alerts**: 
     - Alerts **001, 003, 004, 005, 007, 008,** and **010** all involve `FIN-SERVER01`, indicating potential unauthorized access, exfiltration, and persistence mechanisms.

2. **Step 2: Investigate Initial Access Vector on `FIN-SERVER01`**
   - **Alert 005 (Unauthorized RDP Access)**: 
     - A non-privileged account gained RDP access, suggesting either compromised credentials or lateral movement.
     - **Action**: Check the login source IP, timestamp, and origin account for signs of credential theft or internal compromise.
   - **Alert 007 (New Administrative Account)**:
     - A new admin account `temp_admin` was created without change approval. This account might have been created for persistence.
     - **Action**: Confirm if `temp_admin` is associated with the initial unauthorized RDP session and review recent user activity for actions taken by `temp_admin`.

3. **Step 3: Analyze Potential Data Exfiltration Events**
   - **Alert 004 (Outbound Traffic to Suspicious IP)**:
     - `FIN-SERVER01` connected to a suspicious external IP (`203.0.113.45`) over HTTPS, with a large data transfer noted.
     - **Action**: Review VPC Flow Logs to confirm the amount and type of data transferred, and correlate this with file access logs to determine if sensitive files were accessed before exfiltration.
   - **Alert 008 (High Outbound Data Transfer via FTP)**:
     - FTP transfers to IP `192.0.2.50` from `FIN-SERVER01` indicate possible data exfiltration using FTP.
     - **Action**: Analyze FTP logs to identify which files were transferred and compare these with sensitive files listed in Alert 001.

4. **Step 4: Examine Persistence Mechanisms**
   - **Alert 003 (Suspicious PowerShell Activity)**:
     - An encoded PowerShell command executed on `FIN-SERVER01` could indicate a remote shell or data extraction script.
     - **Action**: Decode the PowerShell script to determine its purpose. Look for common data exfiltration or command-and-control (C2) functions.
   - **Alert 010 (Suspicious Scheduled Task)**:
     - A new scheduled task running an encoded PowerShell script every hour suggests persistence.
     - **Action**: Decode the scheduled task payload and confirm if it aligns with the encoded PowerShell script from Alert 003.

5. **Step 5: Correlate Alerts to Identify Attack Path and Scope**
   - The RDP access (Alert 005) allowed the attacker to create `temp_admin` (Alert 007), escalating privileges on `FIN-SERVER01`.
   - With elevated access, the attacker deployed a scheduled task (Alert 010) and used PowerShell (Alert 003) to initiate data exfiltration to external IPs over HTTPS and FTP (Alerts 004 and 008).
   - **Conclusion**: The compromise originated from unauthorized RDP access, which led to privilege escalation, persistence setup, and data exfiltration attempts.

<div class="neon-line"></div>

### **Detailed Investigation Findings**

| **Alert**     | **Details**                                                                                                                                                                                                                                       |
|---------------|---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|
| **Initial Access** | - Unauthorized RDP access to `FIN-SERVER01` from non-privileged account (Alert 005).  <br> - Likely entry point allowing attacker to escalate privileges and create admin account (`temp_admin`) for further actions.                             |
| **Privilege Escalation** | - `temp_admin` account created without approval (Alert 007). <br> - `temp_admin` used for further configuration changes and potential exfiltration activities.                                                                          |
| **Data Exfiltration** | - Outbound HTTPS connection to suspicious IP `203.0.113.45` with high data transfer (Alert 004). <br> - Additional FTP transfer to IP `192.0.2.50` (Alert 008). <br> - File access logs (Alert 001) show multiple accesses to sensitive files. |
| **Persistence Mechanisms** | - Encoded PowerShell script executed (Alert 003). <br> - Scheduled task configured to run an encoded PowerShell script every hour (Alert 010), likely ensuring attacker access or executing data transfer at intervals.                 |

<div class="neon-line"></div>

### **Containment and Remediation Actions**

1. **Immediate Actions:**
   - **Disable RDP Access and `temp_admin` Account**: Disable unauthorized accounts and RDP on `FIN-SERVER01` to prevent further unauthorized access.
   - **Terminate External Connections**: Block IPs `203.0.113.45` and `192.0.2.50` at the firewall to halt data exfiltration attempts.
   - **Quarantine FIN-SERVER01**: Disconnect `FIN-SERVER01` from the network to halt ongoing malicious scripts and scheduled tasks.

2. **Investigation and Forensics:**
   - **Analyze Decoded PowerShell and Scheduled Task Scripts**: Confirm the purpose of these scripts and identify if they were used for exfiltration, C2 communication, or remote access.
   - **Inspect File Access Logs**: Verify which files were accessed and potentially exfiltrated. Notify data owners if sensitive files were compromised.

3. **Remediation Steps:**
   - **Reset Credentials**: Perform a password reset for all accounts with access to `FIN-SERVER01` and strengthen MFA policies.
   - **Patch and Update Security Configurations**: Ensure the latest patches are applied on `FIN-SERVER01` and implement logging to monitor for abnormal admin activity.
   - **Monitor for Residual Malware**: Scan `FIN-SERVER01` for any remaining malware or unauthorized configurations left by the attacker.

4. **Implement Long-Term Security Measures:**
   - **Review Privilege and Access Controls**: Limit RDP and administrative access to critical servers like `FIN-SERVER01`.
   - **Enhanced Monitoring for Suspicious Data Transfers**: Use data loss prevention (DLP) solutions to detect and alert on unusual data transfers from critical assets.

<div class="neon-line"></div>

### **Conclusion**

This scenario required identifying the relevant alerts related to `FIN-SERVER01` (Initial Access, Privilege Escalation, Data Exfiltration, and Persistence) and filtering out unrelated alerts. By following a structured approach, the SOC team was able to contain the compromise and prevent further data loss while implementing long-term security controls.

<div class="neon-line"></div>

#### Created on: Nov 13, 2024
---
<div style="text-align: center;">
	<div class="gradient-text">👾 2024 rabb1th0les (Chris A)dams 👾</div> 
	🌴☀Thanks for supporting my page ☀🌴
	<nav>
		<ul style="list-style: none; padding: 0;">
			<div style="text-align: center;">
				<li><a href="index.html">Home</a> | <a href="Contact.html">Contact</a></li>
			</div>
		</ul>
	</nav>	
</div>

